<!DOCTYPE html>
<html lang="en">
<!-- This should be BEFORE your custom JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - FitTracker</title>

    <!-- Bootstrap CSS - Enhanced version -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Font Awesome Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

    <!-- Google Fonts for better typography -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* Enhanced Custom Styling with Beautiful Colors */
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --success-gradient: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            --danger-gradient: linear-gradient(135deg, #fc466b 0%, #3f5efb 100%);
            --warning-gradient: linear-gradient(135deg, #fdbb2d 0%, #22c1c3 100%);
            --info-gradient: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            --dark-gradient: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
        }

        * {
            font-family: 'Inter', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }

        /* Enhanced Navigation */
        .navbar {
            background: var(--primary-gradient) !important;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .navbar-brand {
            font-size: 1.8rem !important;
            font-weight: 700 !important;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        /* Beautiful Sidebar */
        .sidebar {
            background: linear-gradient(180deg, #ffffff 0%, #f8f9ff 100%);
            border-right: 1px solid rgba(0, 0, 0, 0.08);
            box-shadow: 4px 0 20px rgba(0, 0, 0, 0.05);
            min-height: calc(100vh - 76px);
        }

        .sidebar .nav-link {
            border-radius: 12px !important;
            margin: 4px 12px !important;
            padding: 12px 20px !important;
            font-weight: 500;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            color: #64748b;
        }

        .sidebar .nav-link:hover {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            transform: translateX(4px);
        }

        .sidebar .nav-link.active {
            background: var(--primary-gradient) !important;
            color: white !important;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            transform: translateX(4px);
        }

        /* Enhanced Buttons */
        .btn {
            border-radius: 12px !important;
            font-weight: 600 !important;
            letter-spacing: 0.025em;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .btn-primary {
            background: var(--primary-gradient);
            border: none;
        }

        .btn-success {
            background: var(--success-gradient);
            border: none;
        }

        .btn-danger {
            background: var(--danger-gradient);
            border: none;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }

        /* Beautiful Cards */
        .card {
            border-radius: 20px !important;
            border: none !important;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.12);
        }

        .card-header {
            background: var(--primary-gradient) !important;
            border-radius: 20px 20px 0 0 !important;
            border: none !important;
            padding: 20px !important;
        }

        /* Enhanced Stat Cards */
        .stat-card {
            border-radius: 20px !important;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            position: relative;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
        }

        .stat-card.calories-card::before {
            background: linear-gradient(135deg, #ff6b6b 0%, #ff8e53 100%);
        }

        .stat-card.meals-card::before {
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
        }

        .stat-card.workouts-card::before {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }

        .stat-card.progress-card::before {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        }

        .stat-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 16px 50px rgba(0, 0, 0, 0.15);
        }

        .stat-icon {
            font-size: 3rem !important;
            margin-bottom: 12px;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Enhanced Typography */
        .display-4 {
            font-weight: 700 !important;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        h1,
        .h1 {
            font-size: 2.5rem !important;
            font-weight: 700 !important;
            color: #1e293b;
        }

        h2,
        .h2 {
            font-size: 2rem !important;
            font-weight: 600 !important;
            color: #334155;
        }

        h5,
        .h5 {
            font-size: 1.25rem !important;
            font-weight: 600 !important;
        }

        /* Enhanced Form Controls */
        .form-control,
        .form-select {
            border-radius: 12px !important;
            border: 2px solid #e2e8f0 !important;
            padding: 12px 16px !important;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .form-control:focus,
        .form-select:focus {
            border-color: #667eea !important;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1) !important;
        }

        /* Enhanced Alerts */
        .alert {
            border-radius: 16px !important;
            border: none !important;
            font-weight: 500;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        /* Enhanced Progress Bars */
        .progress {
            border-radius: 12px !important;
            height: 12px !important;
            background: rgba(0, 0, 0, 0.05);
        }

        .progress-bar {
            border-radius: 12px !important;
            background: var(--success-gradient);
        }

        /* Activity Items */
        .activity-item {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 16px !important;
            padding: 16px !important;
            margin-bottom: 12px !important;
            border: 2px solid rgba(102, 126, 234, 0.1) !important;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .activity-item:hover {
            transform: translateX(8px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border-color: rgba(102, 126, 234, 0.2) !important;
        }

        /* Loading Animation */
        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }
        }

        .loading {
            animation: pulse 1.5s ease-in-out infinite;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .stat-card {
                margin-bottom: 16px;
            }

            .card {
                margin-bottom: 20px;
            }

            h1,
            .h1 {
                font-size: 2rem !important;
            }
        }
    </style>
</head>


<body>
    <!-- Navigation -->
    <!-- Enhanced Navigation with Beautiful Styling -->
    <nav class="navbar navbar-expand-lg navbar-dark shadow-lg position-sticky top-0" style="z-index: 1030;">
        <div class="container-fluid px-4">
            <a class="navbar-brand d-flex align-items-center" href="#">
                <i class="fas fa-dumbbell me-3" style="font-size: 1.5rem;"></i>
                <span>üèãÔ∏è FitTracker</span>
            </a>

            <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarNav">
                <div class="navbar-nav ms-auto">
                    <div class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle d-flex align-items-center px-3" href="#" role="button"
                            data-bs-toggle="dropdown">
                            <i class="fas fa-user-circle me-2" style="font-size: 1.4rem;"></i>
                            <span id="userName" class="fw-semibold">üë§ User</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end shadow-lg border-0">
                            <li><a class="dropdown-item py-2 px-3" href="#" onclick="toggleTheme()">
                                    <i class="fas fa-moon me-3 text-primary"></i>üåô Dark Mode
                                </a></li>
                            <li><a class="dropdown-item py-2 px-3" href="#" onclick="downloadData()">
                                    <i class="fas fa-download me-3 text-success"></i>üìä Download Data
                                </a></li>
                            <li>
                                <hr class="dropdown-divider my-2">
                            </li>
                            <li><a class="dropdown-item py-2 px-3" href="#" onclick="logout()">
                                    <i class="fas fa-sign-out-alt me-3 text-danger"></i>üö™ Logout
                                </a></li>
                        </ul>

                    </div>
                </div>
            </div>
        </div>
    </nav>


    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <!-- Enhanced Sidebar with Beautiful Navigation -->
            <nav class="col-md-3 col-lg-2 d-md-block sidebar px-0">
                <div class="position-sticky pt-4">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active d-flex align-items-center" href="javascript:void(0)"
                                onclick="switchSection('dashboard')">
                                <i class="fas fa-tachometer-alt me-3"></i>
                                <span>üìä Dashboard</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link d-flex align-items-center" href="javascript:void(0)"
                                onclick="switchSection('meals')">
                                <i class="fas fa-utensils me-3"></i>
                                <span>üçΩÔ∏è Meals</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link d-flex align-items-center" href="javascript:void(0)"
                                onclick="switchSection('workouts')">
                                <i class="fas fa-dumbbell me-3"></i>
                                <span>üí™ Workouts</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link d-flex align-items-center" href="javascript:void(0)"
                                onclick="switchSection('progress')">
                                <i class="fas fa-chart-line me-3"></i>
                                <span>üìà Progress</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link d-flex align-items-center" href="javascript:void(0)"
                                onclick="switchSection('friends')">
                                <i class="fas fa-users me-3"></i>
                                <span>üë• Friends</span>
                            </a>
                        </li>
                    </ul>

                    <!-- Quick Stats in Sidebar -->
                    <div class="mt-4 px-3">
                        <div class="card border-0"
                            style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);">
                            <div class="card-body text-center py-3">
                                <div class="mb-2">üéØ</div>
                                <small class="text-muted fw-semibold">Daily Goal</small>
                                <div class="mt-1">
                                    <span class="badge bg-primary rounded-pill">500 cal</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </nav>


            <!-- Main Content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <!-- Dashboard Section -->
                <div id="dashboard-section" class="content-section active">
                    <div
                        class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2">üìä Today's Overview</h1>
                    </div>

                    <!-- Stats Cards -->
                    <!-- Enhanced Stats Cards with Beautiful Colors -->
                    <div class="row g-4 mb-5">
                        <div class="col-md-3 col-sm-6">
                            <div class="card stat-card calories-card h-100">
                                <div class="card-body text-center p-4">
                                    <div class="stat-icon">üî•</div>
                                    <h5 class="card-title fw-bold text-muted mb-2">Calories Burned</h5>
                                    <h2 id="caloriesBurned" class="fw-bold mb-2" style="color: #ff6b6b;">0</h2>
                                    <small class="text-muted">
                                        <i class="fas fa-target me-1"></i>Goal: <span class="fw-semibold">500</span>
                                    </small>
                                    <div class="progress mt-3" style="height: 8px;">
                                        <div class="progress-bar" id="caloriesProgress"
                                            style="width: 0%; background: linear-gradient(135deg, #ff6b6b 0%, #ff8e53 100%);">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-3 col-sm-6">
                            <div class="card stat-card meals-card h-100">
                                <div class="card-body text-center p-4">
                                    <div class="stat-icon">ü•ó</div>
                                    <h5 class="card-title fw-bold text-muted mb-2">Meals Today</h5>
                                    <h2 id="mealsCount" class="fw-bold mb-2" style="color: #4ecdc4;">0</h2>
                                    <small class="text-muted">
                                        <i class="fas fa-utensils me-1"></i>Goal: <span class="fw-semibold">3-5
                                            meals</span>
                                    </small>
                                    <div class="mt-3">
                                        <span class="badge rounded-pill"
                                            style="background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%); font-size: 0.8rem;">
                                            <i class="fas fa-leaf me-1"></i>Healthy Choice
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-3 col-sm-6">
                            <div class="card stat-card workouts-card h-100">
                                <div class="card-body text-center p-4">
                                    <div class="stat-icon">üèãÔ∏è</div>
                                    <h5 class="card-title fw-bold text-muted mb-2">Workouts</h5>
                                    <h2 id="workoutsCount" class="fw-bold mb-2" style="color: #fa709a;">0</h2>
                                    <small class="text-muted">
                                        <i class="fas fa-dumbbell me-1"></i>Goal: <span class="fw-semibold">1+
                                            workout</span>
                                    </small>
                                    <div class="mt-3">
                                        <span class="badge rounded-pill"
                                            style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); font-size: 0.8rem;">
                                            <i class="fas fa-fire me-1"></i>Stay Strong
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-3 col-sm-6">
                            <div class="card stat-card progress-card h-100">
                                <div class="card-body text-center p-4">
                                    <div class="stat-icon">üìä</div>
                                    <h5 class="card-title fw-bold text-muted mb-2">Daily Progress</h5>
                                    <h2 id="dailyProgress" class="fw-bold mb-2" style="color: #667eea;">0%</h2>
                                    <div class="progress mt-3" style="height: 12px;">
                                        <div class="progress-bar" id="progressBar" style="width: 0%;"></div>
                                    </div>
                                    <small class="text-muted mt-2 d-block">
                                        <i class="fas fa-trophy me-1"></i>Keep Going! üí™
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- UPDATE THIS ENTIRE ROW - Replace your BMI calculator section with this -->
                    <div class="row g-4 mb-4">
                        <!-- BMI Calculator Card (Left Side) -->
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-header bg-primary text-white">
                                    <h5 class="mb-0 fw-bold">üìè BMI Calculator</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label class="form-label fw-semibold">Height (cm)</label>
                                            <input type="number" class="form-control" id="height" placeholder="000">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label fw-semibold">Weight (kg)</label>
                                            <input type="number" class="form-control" id="weight" placeholder="00">
                                        </div>
                                    </div>
                                    <button class="btn btn-success mt-3 w-100" onclick="calculateBMI()">
                                        <i class="fas fa-calculator me-2"></i>Calculate My BMI
                                    </button>

                                    <div id="bmiResult" class="mt-3" style="display: none;">
                                        <div class="alert alert-info">
                                            <div class="text-center">
                                                <h4>Your BMI: <span id="bmiValue"></span></h4>
                                                <div id="bmiCategory"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Weather API Card (Right Side) -->
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-header bg-warning text-dark">
                                    <h5 class="mb-0 fw-bold">üå§Ô∏è Outdoor Workout Suggestions</h5>
                                </div>
                                <div class="card-body">
                                    <div id="weatherInfo" class="text-center">
                                        <div class="d-flex justify-content-center align-items-center"
                                            style="min-height: 120px;">
                                            <div>
                                                <div class="spinner-border text-primary mb-2" role="status"></div>
                                                <p class="text-muted mb-0">Getting weather info...</p>
                                                <button class="btn btn-sm btn-outline-primary mt-2"
                                                    onclick="getWeatherSuggestions()">
                                                    üìç Get Weather
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- END BMI & WEATHER ROW -->



                </div>

                <!-- Meals Section -->
                <!-- Enhanced Meals Section -->
                <div id="meals-section" class="content-section">
                    <div
                        class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-4">
                        <h1 class="h2 fw-bold">üçΩÔ∏è Meal Tracker</h1>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <span class="badge bg-success rounded-pill px-3 py-2">
                                <i class="fas fa-leaf me-1"></i>Nutrition Focus
                            </span>
                        </div>
                    </div>

                    <div class="row g-4">
                        <div class="col-lg-6">
                            <div class="card h-100">
                                <div class="card-header d-flex align-items-center">
                                    <i class="fas fa-plus-circle me-2" style="font-size: 1.3rem;"></i>
                                    <h5 class="mb-0 fw-bold">ü•ô Add New Meal</h5>
                                </div>
                                <div class="card-body p-4">
                                    <form id="mealForm">
                                        <div class="mb-4">
                                            <label for="mealSelect" class="form-label fw-semibold">
                                                <i class="fas fa-utensils me-2 text-primary"></i>Choose Your Meal
                                            </label>
                                            <select class="form-select" id="mealSelect">
                                                <option value="">üç¥ Select a delicious meal...</option>
                                                <option value="breakfast_cereal">ü•£ Breakfast Cereal (350 cal)</option>
                                                <option value="chicken_salad">ü•ó Chicken Salad (280 cal)</option>
                                                <option value="pasta_dinner">üçù Pasta Dinner (520 cal)</option>
                                                <option value="fruit_smoothie">ü•§ Fruit Smoothie (180 cal)</option>
                                                <option value="grilled_fish">üêü Grilled Fish (320 cal)</option>
                                                <option value="veggie_bowl">ü•ô Veggie Bowl (250 cal)</option>
                                            </select>
                                        </div>
                                        <button type="submit" class="btn btn-success btn-lg w-100">
                                            <i class="fas fa-plus me-2"></i>‚ú® Add to My Meals
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-6">
                            <div class="card h-100">
                                <div class="card-header d-flex align-items-center">
                                    <i class="fas fa-list me-2" style="font-size: 1.3rem;"></i>
                                    <h5 class="mb-0 fw-bold">üìã Today's Meals</h5>
                                </div>
                                <div class="card-body p-4">
                                    <div id="mealsList">
                                        <div class="text-center py-4">
                                            <div class="mb-3" style="font-size: 3rem; opacity: 0.3;">üçΩÔ∏è</div>
                                            <p class="text-muted fw-medium">No meals added today</p>
                                            <small class="text-muted">Start by adding your first meal above! üåü</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- Workouts Section -->
                <!-- Enhanced Workouts Section -->
                <div id="workouts-section" class="content-section">
                    <div
                        class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-4">
                        <h1 class="h2 fw-bold">üí™ Workout Tracker</h1>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <span class="badge bg-warning rounded-pill px-3 py-2">
                                <i class="fas fa-fire me-1"></i>Burn Calories
                            </span>
                        </div>
                    </div>

                    <div class="row g-4">
                        <div class="col-lg-6">
                            <div class="card h-100">
                                <div class="card-header d-flex align-items-center">
                                    <i class="fas fa-dumbbell me-2" style="font-size: 1.3rem;"></i>
                                    <h5 class="mb-0 fw-bold">üèÉ Log Workout</h5>
                                </div>
                                <div class="card-body p-4">
                                    <form id="workoutForm">
                                        <div class="mb-4">
                                            <label for="exerciseSelect" class="form-label fw-semibold">
                                                <i class="fas fa-running me-2 text-primary"></i>Choose Your Exercise
                                            </label>
                                            <select class="form-select" id="exerciseSelect">
                                                <option value="">üí™ Select an awesome exercise...</option>
                                                <option value="running_30min">üèÉ Running (30 min) - 300 cal</option>
                                                <option value="cycling_45min">üö¥ Cycling (45 min) - 400 cal</option>
                                                <option value="weightlifting_60min">üèãÔ∏è Weight Lifting (60 min) - 250
                                                    cal</option>
                                                <option value="swimming_30min">üèä Swimming (30 min) - 350 cal</option>
                                                <option value="yoga_45min">üßò Yoga (45 min) - 150 cal</option>
                                                <option value="boxing_30min">ü•ä Boxing (30 min) - 300 cal</option>
                                            </select>
                                        </div>
                                        <button type="submit" class="btn btn-primary btn-lg w-100">
                                            <i class="fas fa-plus me-2"></i>üî• Log My Workout
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-6">
                            <div class="card h-100">
                                <div class="card-header d-flex align-items-center">
                                    <i class="fas fa-chart-bar me-2" style="font-size: 1.3rem;"></i>
                                    <h5 class="mb-0 fw-bold">üìä Today's Workouts</h5>
                                </div>
                                <div class="card-body p-4">
                                    <div id="workoutsList">
                                        <div class="text-center py-4">
                                            <div class="mb-3" style="font-size: 3rem; opacity: 0.3;">üèãÔ∏è</div>
                                            <p class="text-muted fw-medium">No workouts logged today</p>
                                            <small class="text-muted">Time to get moving! üí™‚ú®</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- Progress Section -->
                <!-- Enhanced Progress Section -->
                <div id="progress-section" class="content-section">
                    <div
                        class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-4">
                        <h1 class="h2 fw-bold">üìà Progress Analytics</h1>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <span class="badge bg-info rounded-pill px-3 py-2">
                                <i class="fas fa-chart-line me-1"></i>Weekly View
                            </span>
                        </div>
                    </div>

                    <!-- Progress Summary Cards -->
                    <div class="row g-4 mb-4">
                        <div class="col-md-3">
                            <div class="card stat-card h-100">
                                <div class="card-body text-center p-4">
                                    <div class="stat-icon">üìÖ</div>
                                    <h6 class="fw-bold text-muted mb-2">Days Active</h6>
                                    <h3 id="activeDays" class="fw-bold" style="color: #667eea;">0</h3>
                                    <small class="text-muted">This Week</small>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-3">
                            <div class="card stat-card h-100">
                                <div class="card-body text-center p-4">
                                    <div class="stat-icon">üî•</div>
                                    <h6 class="fw-bold text-muted mb-2">Weekly Calories</h6>
                                    <h3 id="weeklyCalories" class="fw-bold" style="color: #ff6b6b;">0</h3>
                                    <small class="text-muted">Total Burned</small>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-3">
                            <div class="card stat-card h-100">
                                <div class="card-body text-center p-4">
                                    <div class="stat-icon">ü•ó</div>
                                    <h6 class="fw-bold text-muted mb-2">Weekly Meals</h6>
                                    <h3 id="weeklyMeals" class="fw-bold" style="color: #4ecdc4;">0</h3>
                                    <small class="text-muted">Total Logged</small>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-3">
                            <div class="card stat-card h-100">
                                <div class="card-body text-center p-4">
                                    <div class="stat-icon">üí™</div>
                                    <h6 class="fw-bold text-muted mb-2">Weekly Workouts</h6>
                                    <h3 id="weeklyWorkouts" class="fw-bold" style="color: #fa709a;">0</h3>
                                    <small class="text-muted">Sessions</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Weekly Progress Chart -->
                    <div class="row g-4">
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0 fw-bold">üìä Weekly Progress Overview</h5>
                                </div>
                                <div class="card-body">
                                    <div id="weeklyProgressChart">
                                        <div class="text-center py-4">
                                            <div class="mb-3" style="font-size: 3rem; opacity: 0.3;">üìà</div>
                                            <p class="text-muted">Your weekly progress will appear here as you add more
                                                data!</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0 fw-bold">üéØ Goals Status</h5>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <div class="d-flex justify-content-between mb-1">
                                            <small class="fw-semibold">Daily Calories (500)</small>
                                            <small id="caloriesGoalPercent">0%</small>
                                        </div>
                                        <div class="progress" style="height: 8px;">
                                            <div class="progress-bar bg-danger" id="caloriesGoalBar" style="width: 0%">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <div class="d-flex justify-content-between mb-1">
                                            <small class="fw-semibold">Daily Meals (3)</small>
                                            <small id="mealsGoalPercent">0%</small>
                                        </div>
                                        <div class="progress" style="height: 8px;">
                                            <div class="progress-bar bg-success" id="mealsGoalBar" style="width: 0%">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <div class="d-flex justify-content-between mb-1">
                                            <small class="fw-semibold">Daily Workouts (1)</small>
                                            <small id="workoutsGoalPercent">0%</small>
                                        </div>
                                        <div class="progress" style="height: 8px;">
                                            <div class="progress-bar bg-primary" id="workoutsGoalBar" style="width: 0%">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="mt-4 p-3 rounded"
                                        style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);">
                                        <div class="text-center">
                                            <h4 id="overallGoalPercent" class="fw-bold mb-1">0%</h4>
                                            <small class="text-muted">Overall Progress Today</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Friends Section -->
                <!-- Enhanced Friends Section -->
                <div id="friends-section" class="content-section">
                    <div
                        class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-4">
                        <h1 class="h2 fw-bold">üë• Social Fitness</h1>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <button class="btn btn-primary rounded-pill">
                                <i class="fas fa-user-plus me-2"></i>Add Friends
                            </button>
                        </div>
                    </div>

                    <!-- Social Features Coming Soon -->
                    <div class="row g-4">
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0 fw-bold">üåü Friend Activity Feed</h5>
                                </div>
                                <div class="card-body">
                                    <div class="text-center py-5">
                                        <div class="mb-4" style="font-size: 4rem; opacity: 0.3;">üë´</div>
                                        <h5 class="fw-bold mb-3">Connect with Friends!</h5>
                                        <p class="text-muted mb-4">Share your fitness journey and stay motivated
                                            together.</p>

                                        <!-- Demo Activity Items -->
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <div class="activity-item p-3 rounded">
                                                    <div class="d-flex align-items-center">
                                                        <div class="me-3" style="font-size: 2rem;">üèÉ</div>
                                                        <div class="text-start">
                                                            <strong>Demo User</strong>
                                                            <div class="text-muted small">Completed a 30-min run</div>
                                                            <div class="text-success small fw-semibold">300 calories
                                                                burned</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-md-6">
                                                <div class="activity-item p-3 rounded">
                                                    <div class="d-flex align-items-center">
                                                        <div class="me-3" style="font-size: 2rem;">ü•ó</div>
                                                        <div class="text-start">
                                                            <strong>Fitness Buddy</strong>
                                                            <div class="text-muted small">Had a healthy lunch</div>
                                                            <div class="text-info small fw-semibold">Chicken Salad - 280
                                                                cal</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="mt-4">
                                            <span class="badge bg-warning rounded-pill px-3 py-2">
                                                <i class="fas fa-clock me-1"></i>Coming Soon - Social Features!
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0 fw-bold">üèÜ Leaderboard</h5>
                                </div>
                                <div class="card-body">
                                    <div class="text-center py-4">
                                        <div class="mb-3" style="font-size: 2.5rem;">ü•á</div>
                                        <h6 class="fw-bold mb-2">Weekly Challenge</h6>
                                        <p class="text-muted small">Compete with friends to burn the most calories!</p>

                                        <div class="mt-4">
                                            <div class="d-flex justify-content-between align-items-center mb-2 p-2 rounded"
                                                style="background: rgba(255, 215, 0, 0.1);">
                                                <span>ü•á You</span>
                                                <strong>0 cal</strong>
                                            </div>
                                            <div class="d-flex justify-content-between align-items-center mb-2 p-2 rounded"
                                                style="background: rgba(192, 192, 192, 0.1);">
                                                <span>ü•à Friend 1</span>
                                                <strong>0 cal</strong>
                                            </div>
                                            <div class="d-flex justify-content-between align-items-center p-2 rounded"
                                                style="background: rgba(205, 127, 50, 0.1);">
                                                <span>ü•â Friend 2</span>
                                                <strong>0 cal</strong>
                                            </div>
                                        </div>

                                        <div class="mt-3">
                                            <small class="text-muted">Start working out to climb the leaderboard!
                                                üí™</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- Working JavaScript -->
                <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
                <!-- Replace the existing script tags with these -->
                <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
                <script src="js/api.js"></script>
                <script src="js/auth.js"></script>

                <!-- Enhanced Navigation Script (keep the working navigation + add data integration) -->
                <script>
                    // Keep your working navigation function
                    function switchSection(sectionName) {
                        console.log('üîÑ Switching to section:', sectionName);

                        try {
                            // Hide all sections
                            const allSections = document.querySelectorAll('.content-section');
                            allSections.forEach(section => {
                                section.style.display = 'none';
                                section.classList.remove('active');
                            });

                            // Show target section
                            const targetSection = document.getElementById(`${sectionName}-section`);
                            if (targetSection) {
                                targetSection.style.display = 'block';
                                targetSection.classList.add('active');
                                console.log('‚úÖ Successfully switched to:', sectionName);
                            } else {
                                console.error('‚ùå Section not found:', `${sectionName}-section`);
                                return;
                            }

                            // Update sidebar navigation
                            const allNavLinks = document.querySelectorAll('.nav-link');
                            allNavLinks.forEach(link => {
                                link.classList.remove('active');
                            });

                            const currentNavLink = document.querySelector(`[onclick="switchSection('${sectionName}')"]`);
                            if (currentNavLink) {
                                currentNavLink.classList.add('active');
                            }

                            window.scrollTo(0, 0);

                        } catch (error) {
                            console.error('‚ùå Error switching sections:', error);
                        }
                    }

                    // Data Management Functions
                    let todayMeals = [];
                    let todayWorkouts = [];

                    // Load user data on page load
                    document.addEventListener('DOMContentLoaded', async function () {
                        console.log('üöÄ Dashboard initialized');
                        switchSection('dashboard');

                        // Load today's data from MongoDB
                        await loadTodayData();

                        // Setup form listeners
                        setupFormListeners();
                    });

                    // Load today's meals and workouts from MongoDB
                    async function loadTodayData() {
                        try {
                            // Load meals
                            const mealsResponse = await api.getTodayMeals();
                            todayMeals = mealsResponse.meals || [];
                            updateMealsDisplay();

                            // Load workouts
                            const workoutsResponse = await api.getTodayWorkouts();
                            todayWorkouts = workoutsResponse.workouts || [];
                            updateWorkoutsDisplay();

                            // Update dashboard stats
                            updateDashboardStats();

                        } catch (error) {
                            console.error('Error loading data:', error);
                        }
                    }

                    // Setup form event listeners
                    function setupFormListeners() {
                        // Meal form
                        const mealForm = document.getElementById('mealForm');
                        if (mealForm) {
                            mealForm.addEventListener('submit', handleAddMeal);
                        }

                        // Workout form
                        const workoutForm = document.getElementById('workoutForm');
                        if (workoutForm) {
                            workoutForm.addEventListener('submit', handleAddWorkout);
                        }

                        // Meal select dropdown
                        const mealSelect = document.getElementById('mealSelect');
                        if (mealSelect) {
                            mealSelect.addEventListener('change', updateMealInfo);
                        }

                        // Exercise select dropdown
                        const exerciseSelect = document.getElementById('exerciseSelect');
                        if (exerciseSelect) {
                            exerciseSelect.addEventListener('change', updateWorkoutInfo);
                        }
                    }
// Progress Analytics JavaScript
// Progress Analytics JavaScript - Updated for your HTML structure
class ProgressAnalytics {
    constructor() {
        this.api = api; // Use your existing API instance
        this.initializeProgressPage();
    }

    async initializeProgressPage() {
        try {
            console.log('üìä Initializing progress analytics...');
            
            // Check authentication
            const token = localStorage.getItem('fittracker_token');
            if (!token) {
                window.location.href = 'login.html';
                return;
            }

            this.api.setToken(token);
            await this.loadProgressData();
            
        } catch (error) {
            console.error('‚ùå Failed to initialize progress page:', error);
            this.showError('Failed to load progress data');
        }
    }

    async loadProgressData() {
        try {
            // Fetch all data in parallel
            const [mealsResponse, workoutsResponse, userResponse] = await Promise.all([
                this.api.getAllMeals().catch(() => ({ meals: [] })),
                this.api.getAllWorkouts().catch(() => ({ workouts: [] })),
                this.api.getCurrentUser().catch(() => ({ user: null }))
            ]);

            const meals = mealsResponse.meals || [];
            const workouts = workoutsResponse.workouts || [];
            const user = userResponse.user || {};

            console.log('‚úÖ Progress data loaded:', {
                meals: meals.length,
                workouts: workouts.length,
                user: user.name || 'Unknown'
            });

            // Update all analytics sections with your exact element IDs
            this.updateWeeklyStats(meals, workouts);
            this.updateGoalsStatus(meals, workouts);
            this.updateWeeklyProgressChart(meals, workouts);

        } catch (error) {
            console.error('‚ùå Error loading progress data:', error);
            this.showError('Unable to load progress data');
        }
    }

    updateWeeklyStats(meals, workouts) {
        try {
            // Get data from last 7 days
            const weekAgo = new Date();
            weekAgo.setDate(weekAgo.getDate() - 7);

            // Filter data for this week
            const weeklyMeals = meals.filter(meal => new Date(meal.createdAt) >= weekAgo);
            const weeklyWorkouts = workouts.filter(workout => new Date(workout.createdAt) >= weekAgo);

            // Calculate active days (unique days with meals or workouts)
            const activeDays = new Set();
            weeklyMeals.forEach(meal => {
                const date = new Date(meal.createdAt).toDateString();
                activeDays.add(date);
            });
            weeklyWorkouts.forEach(workout => {
                const date = new Date(workout.createdAt).toDateString();
                activeDays.add(date);
            });

            // Calculate weekly calories from meals
            const weeklyCalories = weeklyMeals.reduce((sum, meal) => sum + (meal.calories || 0), 0);

            // Update your exact HTML elements
            document.getElementById('activeDays').textContent = activeDays.size;
            document.getElementById('weeklyCalories').textContent = weeklyCalories.toLocaleString();
            document.getElementById('weeklyMeals').textContent = weeklyMeals.length;
            document.getElementById('weeklyWorkouts').textContent = weeklyWorkouts.length;

            console.log('üìä Weekly stats updated:', {
                activeDays: activeDays.size,
                weeklyCalories,
                weeklyMeals: weeklyMeals.length,
                weeklyWorkouts: weeklyWorkouts.length
            });

        } catch (error) {
            console.error('‚ùå Error updating weekly stats:', error);
        }
    }

    updateGoalsStatus(meals, workouts) {
        try {
            // Get today's data
            const today = new Date().toDateString();
            const todayMeals = meals.filter(meal => 
                new Date(meal.createdAt).toDateString() === today
            );
            const todayWorkouts = workouts.filter(workout => 
                new Date(workout.createdAt).toDateString() === today
            );
            const todayCalories = todayMeals.reduce((sum, meal) => sum + (meal.calories || 0), 0);

            // Daily goals (as shown in your HTML)
            const dailyCaloriesGoal = 500;
            const dailyMealsGoal = 3;
            const dailyWorkoutsGoal = 1;

            // Calculate progress percentages
            const caloriesProgress = Math.min((todayCalories / dailyCaloriesGoal) * 100, 100);
            const mealsProgress = Math.min((todayMeals.length / dailyMealsGoal) * 100, 100);
            const workoutsProgress = Math.min((todayWorkouts.length / dailyWorkoutsGoal) * 100, 100);

            // Calculate overall progress
            const overallProgress = Math.round((caloriesProgress + mealsProgress + workoutsProgress) / 3);

            // Update progress bars and percentages
            this.updateProgressBar('caloriesGoalBar', 'caloriesGoalPercent', caloriesProgress);
            this.updateProgressBar('mealsGoalBar', 'mealsGoalPercent', mealsProgress);
            this.updateProgressBar('workoutsGoalBar', 'workoutsGoalPercent', workoutsProgress);

            // Update overall progress
            document.getElementById('overallGoalPercent').textContent = `${overallProgress}%`;

            console.log('üéØ Goals status updated:', {
                calories: `${todayCalories}/${dailyCaloriesGoal}`,
                meals: `${todayMeals.length}/${dailyMealsGoal}`,
                workouts: `${todayWorkouts.length}/${dailyWorkoutsGoal}`,
                overall: `${overallProgress}%`
            });

        } catch (error) {
            console.error('‚ùå Error updating goals status:', error);
        }
    }

    updateProgressBar(barId, percentId, percentage) {
        try {
            const progressBar = document.getElementById(barId);
            const percentText = document.getElementById(percentId);

            if (progressBar) {
                progressBar.style.width = `${percentage}%`;
                progressBar.setAttribute('aria-valuenow', percentage);
            }

            if (percentText) {
                percentText.textContent = `${Math.round(percentage)}%`;
            }
        } catch (error) {
            console.error('‚ùå Error updating progress bar:', error);
        }
    }

    updateWeeklyProgressChart(meals, workouts) {
        try {
            // Get data for last 7 days
            const chartData = [];
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toDateString();

                const dayMeals = meals.filter(meal => 
                    new Date(meal.createdAt).toDateString() === dateStr
                ).length;

                const dayWorkouts = workouts.filter(workout => 
                    new Date(workout.createdAt).toDateString() === dateStr
                ).length;

                const dayCalories = meals
                    .filter(meal => new Date(meal.createdAt).toDateString() === dateStr)
                    .reduce((sum, meal) => sum + (meal.calories || 0), 0);

                chartData.push({
                    day: date.toLocaleDateString('en', { weekday: 'short' }),
                    meals: dayMeals,
                    workouts: dayWorkouts,
                    calories: dayCalories,
                    fullDate: date.toLocaleDateString()
                });
            }

            // Update the weekly progress chart area
            const chartContainer = document.getElementById('weeklyProgressChart');
            if (chartContainer && chartData.some(day => day.meals > 0 || day.workouts > 0)) {
                chartContainer.innerHTML = `
                    <div class="weekly-chart-container">
                        <div class="row text-center mb-3">
                            <div class="col">
                                <small class="text-muted fw-semibold">Daily Activity Overview</small>
                            </div>
                        </div>
                        <div class="row g-2">
                            ${chartData.map(day => `
                                <div class="col">
                                    <div class="day-card p-2 text-center" style="background: rgba(102, 126, 234, 0.1); border-radius: 8px;">
                                        <div class="fw-semibold mb-1" style="font-size: 0.8rem;">${day.day}</div>
                                        <div class="mb-1">
                                            <span class="badge bg-success rounded-pill" style="font-size: 0.7rem;">
                                                üçΩÔ∏è ${day.meals}
                                            </span>
                                        </div>
                                        <div class="mb-1">
                                            <span class="badge bg-primary rounded-pill" style="font-size: 0.7rem;">
                                                üí™ ${day.workouts}
                                            </span>
                                        </div>
                                        <div>
                                            <span class="badge bg-danger rounded-pill" style="font-size: 0.7rem;">
                                                üî• ${day.calories}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            console.log('üìà Weekly progress chart updated:', chartData);

        } catch (error) {
            console.error('‚ùå Error updating weekly progress chart:', error);
        }
    }

    showError(message) {
        console.error('üìä Progress Analytics Error:', message);
        // Optionally show error in UI
    }
}

// Initialize progress analytics when page loads
document.addEventListener('DOMContentLoaded', function() {
    // Only initialize if we're on the progress section
    if (document.getElementById('progress-section')) {
        console.log('üöÄ Progress section found, initializing analytics...');
        new ProgressAnalytics();
    }
});

// Initialize progress analytics when page loads
document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ Progress page DOM loaded, initializing analytics...');
    new ProgressAnalytics();
});

                    // Add this function to your JavaScript section in dashboard.html
                    function updateCaloriesProgress(current, goal = 500) {
                        const percentage = Math.min(100, Math.round((current / goal) * 100));
                        const progressBar = document.getElementById('caloriesProgress');
                        if (progressBar) {
                            progressBar.style.width = percentage + '%';
                            progressBar.setAttribute('aria-valuenow', percentage);
                        }

                        // Also update the main progress bar if it exists
                        const mainProgressBar = document.getElementById('progressBar');
                        if (mainProgressBar) {
                            // Calculate overall progress including calories
                            const caloriesProgress = Math.min(30, (current / goal) * 30);
                            // You can adjust this calculation based on your needs
                            const currentWidth = parseInt(mainProgressBar.style.width) || 0;
                            mainProgressBar.style.width = Math.min(100, currentWidth + caloriesProgress) + '%';
                        }
                    }

                    // Handle adding meals
                    async function handleAddMeal(event) {
                        event.preventDefault();

                        const mealSelect = document.getElementById('mealSelect');
                        if (!mealSelect || !mealSelect.value) {
                            showMessage('Please select a meal', 'error');
                            return;
                        }

                        const mealData = {
                            name: mealSelect.options[mealSelect.selectedIndex].text,
                            calories: getMealCalories(mealSelect.value),
                            protein: getMealProtein(mealSelect.value),
                            carbs: 0,
                            fats: 0
                        };

                        console.log('üçΩÔ∏è Sending meal data:', mealData);

                        try {
                            showMessage('‚è≥ Adding meal...', 'info', 2000);

                            const response = await api.addMeal(mealData);
                            console.log('‚úÖ Meal response:', response);

                            if (response && response.meal) {
                                todayMeals.push(response.meal);
                                updateMealsDisplay();
                                updateDashboardStats();
                                document.getElementById('mealForm').reset();

                                // Use showMessage instead of showSuccessMessage
                                showMessage('ü•ó Meal added successfully!', 'success');

                                if (typeof checkForAchievements === 'function') {
                                    checkForAchievements();
                                }
                            } else {
                                throw new Error('Invalid response format');
                            }

                        } catch (error) {
                            console.error('‚ùå Add meal error:', error);
                            showMessage(`Failed to add meal: ${error.message}`, 'error');

                            // Fallback: Add to local array for testing
                            if (confirm('API failed. Add meal locally for testing?')) {
                                mealData.id = Date.now().toString();
                                mealData._id = mealData.id;
                                mealData.createdAt = new Date().toISOString();
                                todayMeals.push(mealData);
                                updateMealsDisplay();
                                updateDashboardStats();
                                showMessage('‚ö†Ô∏è Meal added locally (not saved to database)', 'warning');
                            }
                        }
                    }

                    // Handle adding workouts
                    // Complete handleAddWorkout function
                    async function handleAddWorkout(event) {
                        event.preventDefault();

                        const exerciseSelect = document.getElementById('exerciseSelect');
                        if (!exerciseSelect || !exerciseSelect.value) {
                            showMessage('Please select an exercise', 'error');
                            return;
                        }

                        const workoutData = {
                            exercise: exerciseSelect.options[exerciseSelect.selectedIndex].text,
                            duration: getWorkoutDuration(exerciseSelect.value),
                            caloriesBurned: getWorkoutCalories(exerciseSelect.value),
                            intensity: 'medium'
                        };

                        try {
                            const response = await api.addWorkout(workoutData);

                            if (response && response.workout) {
                                todayWorkouts.push(response.workout);
                                updateWorkoutsDisplay();
                                updateDashboardStats();
                                document.getElementById('workoutForm').reset();

                                // ONLY use showMessage - never showSuccessMessage
                                showMessage('üí™ Workout logged successfully!', 'success');
                                checkForAchievements();
                            }

                        } catch (error) {
                            console.error('‚ùå Add workout error:', error);
                            showMessage(`Failed to log workout: ${error.message}`, 'error');
                        }
                    }

                    // Complete checkForAchievements function
                    function checkForAchievements() {
                        const totalCalories = (todayWorkouts || []).reduce((sum, workout) => sum + (workout.caloriesBurned || 0), 0);
                        const mealsCount = (todayMeals || []).length;
                        const workoutsCount = (todayWorkouts || []).length;

                        const today = new Date().toISOString().split('T')[0];

                        // ALL using showMessage - NO showSuccessMessage anywhere
                        if (mealsCount === 1 && !localStorage.getItem(`first_meal_${today}`)) {
                            showMessage("üéâ Great start! You logged your first meal today!", 'success', 6000);
                            localStorage.setItem(`first_meal_${today}`, 'true');
                        }

                        if (workoutsCount === 1 && !localStorage.getItem(`first_workout_${today}`)) {
                            showMessage("üí™ Awesome! You completed your first workout today!", 'success', 6000);
                            localStorage.setItem(`first_workout_${today}`, 'true');
                        }

                        if (mealsCount >= 3 && !localStorage.getItem(`three_meals_${today}`)) {
                            showMessage("üèÜ Fantastic! You're maintaining great eating habits!", 'success', 6000);
                            localStorage.setItem(`three_meals_${today}`, 'true');
                        }

                        if (totalCalories >= 500 && !localStorage.getItem(`calories_goal_${today}`)) {
                            showMessage("üî• Amazing! You've burned 500+ calories today!", 'success', 6000);
                            localStorage.setItem(`calories_goal_${today}`, 'true');
                        }
                    }


                    // Add this debug function to check token status
                    function debugTokenStatus() {
                        console.log('üîç Current token:', localStorage.getItem('fittracker_token'));
                        console.log('üîç API base URL:', api.baseURL);
                        console.log('üîç Token in API object:', api.token);

                        if (!api.token) {
                            console.log('‚ùå No token found - user needs to login again');
                            showMessage('‚ö†Ô∏è Please login again - session expired', 'warning');
                            setTimeout(() => {
                                window.location.href = 'login.html';
                            }, 3000);
                            return false;
                        }
                        return true;
                    }

                    // Call this when page loads
                    document.addEventListener('DOMContentLoaded', function () {
                        setTimeout(debugTokenStatus, 1000);
                    });

                    // Simple achievement system
                    function checkForAchievements() {
                        const totalCalories = (todayWorkouts || []).reduce((sum, workout) => sum + (workout.caloriesBurned || 0), 0);
                        const mealsCount = (todayMeals || []).length;
                        const workoutsCount = (todayWorkouts || []).length;

                        const today = new Date().toISOString().split('T')[0];

                        // Use showMessage instead of showSuccessMessage everywhere
                        if (workoutsCount === 1 && !localStorage.getItem(`first_workout_${today}`)) {
                            showMessage("üí™ Awesome! You completed your first workout today!", 'success', 6000);
                            localStorage.setItem(`first_workout_${today}`, 'true');
                        }

                        if (totalCalories >= 500 && !localStorage.getItem(`calories_goal_${today}`)) {
                            showMessage("üî• Amazing! You've burned 500+ calories today!", 'success', 6000);
                            localStorage.setItem(`calories_goal_${today}`, 'true');
                        }
                    }


                    // Update meals display
                    function updateMealsDisplay() {
                        const mealsList = document.getElementById('mealsList');
                        if (!mealsList) return;

                        if (todayMeals.length === 0) {
                            mealsList.innerHTML = '<p class="text-muted">No meals added today</p>';
                            return;
                        }

                        const totalCalories = todayMeals.reduce((sum, meal) => sum + meal.calories, 0);

                        mealsList.innerHTML = `
        <div class="mb-3 p-3 bg-light rounded">
            <strong>Total: ${totalCalories} calories</strong>
        </div>
        ${todayMeals.map(meal => `
            <div class="d-flex justify-content-between align-items-center mb-2 p-2 border rounded">
                <div>
                    <strong>${meal.name}</strong><br>
                    <small>${meal.calories} cal ‚Ä¢ ${meal.protein}g protein</small>
                </div>
                <button class="btn btn-sm btn-danger" onclick="deleteMeal('${meal._id}')">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        `).join('')}
    `;
                    }

                    // Update workouts display
                    function updateWorkoutsDisplay() {
                        const workoutsList = document.getElementById('workoutsList');
                        if (!workoutsList) return;

                        if (todayWorkouts.length === 0) {
                            workoutsList.innerHTML = '<p class="text-muted">No workouts logged today</p>';
                            return;
                        }

                        const totalCalories = todayWorkouts.reduce((sum, workout) => sum + workout.caloriesBurned, 0);

                        workoutsList.innerHTML = `
        <div class="mb-3 p-3 bg-light rounded">
            <strong>Total: ${totalCalories} calories burned</strong>
        </div>
        ${todayWorkouts.map(workout => `
            <div class="d-flex justify-content-between align-items-center mb-2 p-2 border rounded">
                <div>
                    <strong>${workout.exercise}</strong><br>
                    <small>${workout.duration} min ‚Ä¢ ${workout.caloriesBurned} cal</small>
                </div>
                <button class="btn btn-sm btn-danger" onclick="deleteWorkout('${workout._id}')">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        `).join('')}
    `;
                    }

                    // Update dashboard statistics
                    function updateDashboardStats() {
                        const totalCalories = todayWorkouts.reduce((sum, workout) => sum + workout.caloriesBurned, 0);
                        const mealsCount = todayMeals.length;
                        const workoutsCount = todayWorkouts.length;

                        // Calculate progress percentage
                        let progress = 0;
                        if (mealsCount >= 3) progress += 30;
                        else progress += (mealsCount / 3) * 30;

                        if (workoutsCount >= 1) progress += 40;

                        if (totalCalories >= 500) progress += 30;
                        else progress += (totalCalories / 500) * 30;

                        progress = Math.round(progress);

                        // Update DOM elements
                        document.getElementById('caloriesBurned').textContent = totalCalories;
                        document.getElementById('mealsCount').textContent = mealsCount;
                        document.getElementById('workoutsCount').textContent = workoutsCount;
                        document.getElementById('dailyProgress').textContent = `${progress}%`;

                        const progressBar = document.getElementById('progressBar');
                        if (progressBar) {
                            progressBar.style.width = `${progress}%`;
                        }
                    }

                    // Delete functions
                    async function deleteMeal(mealId) {
                        if (!confirm('Delete this meal?')) return;

                        try {
                            await api.deleteMeal(mealId);
                            todayMeals = todayMeals.filter(meal => meal._id !== mealId);
                            updateMealsDisplay();
                            updateDashboardStats();
                            showMessage('Meal deleted!', 'success');
                        } catch (error) {
                            console.error('Error deleting meal:', error);
                            showMessage('Failed to delete meal', 'error');
                        }
                    }

                    async function deleteWorkout(workoutId) {
                        if (!confirm('Delete this workout?')) return;

                        try {
                            await api.deleteWorkout(workoutId);
                            todayWorkouts = todayWorkouts.filter(workout => workout._id !== workoutId);
                            updateWorkoutsDisplay();
                            updateDashboardStats();
                            showMessage('Workout deleted!', 'success');
                        } catch (error) {
                            console.error('Error deleting workout:', error);
                            showMessage('Failed to delete workout', 'error');
                        }
                    }
                    // Enhanced Helper functions for meal/workout data
                    function getMealCalories(mealType) {
                        const calories = {
                            'breakfast_cereal': 350,
                            'chicken_salad': 280,
                            'pasta_dinner': 520,
                            'fruit_smoothie': 180,
                            'grilled_fish': 320,
                            'veggie_bowl': 250
                        };
                        const result = calories[mealType] || 0;
                        console.log(`üçΩÔ∏è Calories for ${mealType}:`, result);
                        return result;
                    }

                    function getMealProtein(mealType) {
                        const protein = {
                            'breakfast_cereal': 8,
                            'chicken_salad': 35,
                            'pasta_dinner': 18,
                            'fruit_smoothie': 6,
                            'grilled_fish': 45,
                            'veggie_bowl': 12
                        };
                        const result = protein[mealType] || 0;
                        console.log(`ü•ó Protein for ${mealType}:`, result);
                        return result;
                    }

                    function getWorkoutCalories(exerciseType) {
                        const calories = {
                            'running_30min': 300,
                            'cycling_45min': 400,
                            'weightlifting_60min': 250,
                            'swimming_30min': 350,
                            'yoga_45min': 150,
                            'boxing_30min': 300
                        };
                        const result = calories[exerciseType] || 0;
                        console.log(`üî• Calories for ${exerciseType}:`, result);
                        return result;
                    }

                    function getWorkoutDuration(exerciseType) {
                        const duration = {
                            'running_30min': 30,
                            'cycling_45min': 45,
                            'weightlifting_60min': 60,
                            'swimming_30min': 30,
                            'yoga_45min': 45,
                            'boxing_30min': 30
                        };
                        const result = duration[exerciseType] || 0;
                        console.log(`‚è±Ô∏è Duration for ${exerciseType}:`, result);
                        return result;
                    }


                    // Update meal/workout info when dropdowns change
                    function updateMealInfo() {
                        // This can be enhanced to show calories/protein info
                    }

                    function updateWorkoutInfo() {
                        // This can be enhanced to show duration/calories info
                    }



                    // Other functions
                    function logout() {
                        localStorage.removeItem('fittracker_token');
                        window.location.href = 'index.html';
                    }

                    // Enhanced download feature with beautiful modal
                    async function downloadData() {
                        try {
                            showMessage("üìä Preparing your comprehensive fitness report...", 'info', 2000);

                            const endDate = new Date().toISOString().split('T')[0];
                            const startDate = new Date();
                            startDate.setDate(startDate.getDate() - 30);
                            const startDateStr = startDate.toISOString().split('T')[0];

                            // Create beautiful download modal
                            const modalHtml = `
            <div class="modal fade" id="downloadModal" tabindex="-1" style="z-index: 9999;">
                <div class="modal-dialog modal-dialog-centered modal-lg">
                    <div class="modal-content" style="border-radius: 20px; border: none; overflow: hidden;">
                        <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none;">
                            <h5 class="modal-title fw-bold d-flex align-items-center">
                                <i class="fas fa-download me-3" style="font-size: 1.5rem;"></i>
                                üìä Download Your Fitness Journey
                            </h5>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body p-4" style="background: linear-gradient(180deg, #f8f9ff 0%, #ffffff 100%);">
                            <!-- Date Range Info -->
                            <div class="alert alert-info border-0 mb-4" style="background: rgba(102, 126, 234, 0.1); border-radius: 12px;">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-calendar-alt me-3 text-primary" style="font-size: 1.5rem;"></i>
                                    <div>
                                        <h6 class="mb-1 fw-bold">üìÖ Report Period</h6>
                                        <p class="mb-0">${startDateStr} to ${endDate} <span class="badge bg-primary rounded-pill ms-2">Last 30 Days</span></p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Data Preview -->
                            <div class="row mb-4">
                                <div class="col-md-4">
                                    <div class="text-center p-3 rounded" style="background: rgba(17, 153, 142, 0.1);">
                                        <i class="fas fa-fire text-success mb-2" style="font-size: 2rem;"></i>
                                        <h6 class="fw-bold">Total Calories</h6>
                                        <p class="mb-0" id="previewCalories">Loading...</p>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="text-center p-3 rounded" style="background: rgba(76, 205, 196, 0.1);">
                                        <i class="fas fa-utensils text-info mb-2" style="font-size: 2rem;"></i>
                                        <h6 class="fw-bold">Total Meals</h6>
                                        <p class="mb-0" id="previewMeals">Loading...</p>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="text-center p-3 rounded" style="background: rgba(250, 112, 154, 0.1);">
                                        <i class="fas fa-dumbbell text-warning mb-2" style="font-size: 2rem;"></i>
                                        <h6 class="fw-bold">Total Workouts</h6>
                                        <p class="mb-0" id="previewWorkouts">Loading...</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Format Selection -->
                            <h6 class="fw-bold mb-3">üéØ Choose Your Download Format:</h6>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <div class="card border-0 h-100 format-card" style="cursor: pointer; transition: all 0.3s ease; background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);" onclick="selectFormat('json')">
                                        <div class="card-body text-center p-4">
                                            <i class="fas fa-code mb-3" style="font-size: 3rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;"></i>
                                            <h6 class="fw-bold mb-2">üìÑ JSON Format</h6>
                                            <small class="text-muted">Complete structured data with all details</small>
                                            <div class="mt-3">
                                                <span class="badge bg-primary rounded-pill">Developer Friendly</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card border-0 h-100 format-card" style="cursor: pointer; transition: all 0.3s ease; background: linear-gradient(135deg, rgba(17, 153, 142, 0.1) 0%, rgba(56, 239, 125, 0.1) 100%);" onclick="selectFormat('csv')">
                                        <div class="card-body text-center p-4">
                                            <i class="fas fa-table mb-3" style="font-size: 3rem; background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;"></i>
                                            <h6 class="fw-bold mb-2">üìä CSV Format</h6>
                                            <small class="text-muted">Perfect for Excel, Google Sheets & analysis</small>
                                            <div class="mt-3">
                                                <span class="badge bg-success rounded-pill">Spreadsheet Ready</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Additional Options -->
                            <div class="mt-4 p-3 rounded" style="background: rgba(253, 187, 45, 0.1);">
                                <h6 class="fw-bold mb-2">üìã What's Included:</h6>
                                <div class="row">
                                    <div class="col-md-6">
                                        <ul class="list-unstyled mb-0">
                                            <li><i class="fas fa-check text-success me-2"></i>Daily progress summaries</li>
                                            <li><i class="fas fa-check text-success me-2"></i>Complete meal logs</li>
                                            <li><i class="fas fa-check text-success me-2"></i>Workout details & calories</li>
                                        </ul>
                                    </div>
                                    <div class="col-md-6">
                                        <ul class="list-unstyled mb-0">
                                            <li><i class="fas fa-check text-success me-2"></i>Goal achievement tracking</li>
                                            <li><i class="fas fa-check text-success me-2"></i>Weekly analytics</li>
                                            <li><i class="fas fa-check text-success me-2"></i>Personal fitness statistics</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;

                            // Add modal to page
                            document.body.insertAdjacentHTML('beforeend', modalHtml);

                            // Load preview data
                            loadDownloadPreview();

                            // Show modal
                            const modal = new bootstrap.Modal(document.getElementById('downloadModal'));
                            modal.show();

                            // Add hover effects to format cards
                            document.querySelectorAll('.format-card').forEach(card => {
                                card.addEventListener('mouseenter', function () {
                                    this.style.transform = 'translateY(-5px)';
                                    this.style.boxShadow = '0 10px 30px rgba(0,0,0,0.15)';
                                });

                                card.addEventListener('mouseleave', function () {
                                    this.style.transform = 'translateY(0)';
                                    this.style.boxShadow = 'none';
                                });
                            });

                            // Global function for format selection
                            window.selectFormat = async (format) => {
                                modal.hide();
                                document.getElementById('downloadModal').remove();

                                // Show detailed download progress
                                showDownloadProgress(format, startDateStr, endDate);
                            };

                        } catch (error) {
                            console.error('Download error:', error);
                            showMessage('‚ùå Download preparation failed. Please try again.', 'error');
                        }
                    }

                    // Load preview data for download modal
                    async function loadDownloadPreview() {
                        try {
                            const weeklyData = await api.getWeeklyProgress();

                            document.getElementById('previewCalories').textContent = `${weeklyData.weeklyStats.totalCalories || 0} cal`;
                            document.getElementById('previewMeals').textContent = `${weeklyData.weeklyStats.totalMeals || 0} meals`;
                            document.getElementById('previewWorkouts').textContent = `${weeklyData.weeklyStats.totalWorkouts || 0} sessions`;
                        } catch (error) {
                            document.getElementById('previewCalories').textContent = 'N/A';
                            document.getElementById('previewMeals').textContent = 'N/A';
                            document.getElementById('previewWorkouts').textContent = 'N/A';
                        }
                    }

                    // Show detailed download progress with animations
                    async function showDownloadProgress(format, startDate, endDate) {
                        const progressSteps = [
                            { message: "üîç Collecting your data...", duration: 1000 },
                            { message: "üìä Analyzing progress patterns...", duration: 800 },
                            { message: "üé® Formatting your report...", duration: 600 },
                            { message: `üì• Generating ${format.toUpperCase()} file...`, duration: 400 }
                        ];

                        // Show progress steps
                        for (let i = 0; i < progressSteps.length; i++) {
                            showMessage(progressSteps[i].message, 'info', progressSteps[i].duration);
                            await new Promise(resolve => setTimeout(resolve, progressSteps[i].duration));
                        }

                        try {
                            // Actually download the file
                            const response = await api.downloadProgress(startDate, endDate, format);
                            const blob = await response.blob();

                            // Create download link
                            const url = window.URL.createObjectURL(blob);
                            const a = document.createElement('a');
                            a.href = url;
                            a.download = `fittracker-report-${endDate}.${format}`;
                            a.style.display = 'none';

                            document.body.appendChild(a);
                            a.click();

                            // Cleanup
                            window.URL.revokeObjectURL(url);
                            document.body.removeChild(a);

                            // Success notification with celebration
                            showMessage(`üéâ Your ${format.toUpperCase()} fitness report has been downloaded successfully!`);

                            // Track download event
                            trackActivity();

                        } catch (error) {
                            console.error('Download error:', error);
                            showMessage(`‚ùå Failed to download ${format.toUpperCase()} file. Please try again.`, 'error');
                        }
                    }

                    // Enhanced theme toggle with smooth transition
                    function toggleTheme() {
                        const body = document.body;
                        const currentTheme = body.getAttribute('data-theme') || 'light';
                        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

                        // Add transition effect
                        body.style.transition = 'all 0.3s ease';

                        body.setAttribute('data-theme', newTheme);
                        localStorage.setItem('fittracker_theme', newTheme);

                        const themeMessages = {
                            'dark': 'üåô Dark mode activated! Easy on the eyes.',
                            'light': '‚òÄÔ∏è Light mode activated! Bright and cheerful.'
                        };

                        showMessage(themeMessages[newTheme], 'info', 3000);

                        // Update theme icon in navbar
                        const themeIcon = document.querySelector('[onclick="toggleTheme()"] i');
                        if (themeIcon) {
                            themeIcon.className = newTheme === 'dark' ? 'fas fa-sun me-2' : 'fas fa-moon me-2';
                        }

                        // Remove transition after animation
                        setTimeout(() => {
                            body.style.transition = '';
                        }, 300);
                    }

                    function toggleTheme() {
                        const body = document.body;
                        const currentTheme = body.getAttribute('data-theme') || 'light';
                        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

                        body.setAttribute('data-theme', newTheme);
                        localStorage.setItem('fittracker_theme', newTheme);

                        showMessage(`Switched to ${newTheme} theme`, 'success');
                    }
// Add this to your dashboard.html or update existing dark mode script
function initializeDarkMode() {
    const darkModeToggle = document.getElementById('darkModeToggle') || document.querySelector('.dark-mode-toggle, [data-theme-toggle]');
    
    if (!darkModeToggle) {
        console.log('‚ùå Dark mode toggle not found');
        return;
    }

    // Check saved theme or default to light
    const savedTheme = localStorage.getItem('fittracker-theme') || 'light';
    document.documentElement.setAttribute('data-theme', savedTheme);
    
    // Update toggle state
    if (savedTheme === 'dark') {
        darkModeToggle.classList.add('active');
        document.body.classList.add('dark-theme');
    }

    // Toggle event listener
    darkModeToggle.addEventListener('click', function(e) {
        e.preventDefault();
        
        const currentTheme = document.documentElement.getAttribute('data-theme');
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        
        // Apply theme immediately
        document.documentElement.setAttribute('data-theme', newTheme);
        document.body.classList.toggle('dark-theme', newTheme === 'dark');
        
        // Update toggle appearance
        this.classList.toggle('active', newTheme === 'dark');
        
        // Save preference
        localStorage.setItem('fittracker-theme', newTheme);
        
        console.log('üåì Theme switched to:', newTheme);
    });

    console.log('‚úÖ Dark mode initialized with theme:', savedTheme);
}

// Initialize when DOM is ready
document.addEventListener('DOMContentLoaded', function() {
    initializeDarkMode();
});

// Also initialize when navigating between sections
document.addEventListener('click', function(e) {
    if (e.target.matches('[data-section], .nav-link')) {
        setTimeout(initializeDarkMode, 100);
    }
});

                    // Real-time motivational messages system
                    const motivationalMessages = [
                        "üî• You're crushing your fitness goals!",
                        "üí™ Every workout makes you stronger!",
                        "üåü Consistency is your superpower!",
                        "üéØ You're so close to your daily goal!",
                        "‚ú® Small progress is still progress!",
                        "üèÜ Champions never give up!",
                        "üíö Your health journey is inspiring!",
                        "üöÄ Keep pushing, you've got this!",
                        "üéä Your dedication is paying off!",
                        "‚≠ê You're becoming the best version of yourself!"
                    ];

                    // Fitness tips for better engagement
                    const fitnessTips = [
                        "üí° Tip: Drink water before, during, and after workouts!",
                        "üí° Tip: Try to eat protein within 30 minutes after exercising!",
                        "üí° Tip: Aim for 7-9 hours of sleep for better recovery!",
                        "üí° Tip: Mix cardio and strength training for best results!",
                        "üí° Tip: Listen to your body - rest when you need it!",
                        "üí° Tip: Set small, achievable goals to stay motivated!"
                    ];

                    // Show random motivation every 5 minutes
                    let motivationInterval = setInterval(() => {
                        // Only show if user is active (has added data recently)
                        const lastActivity = localStorage.getItem('last_activity_time');
                        const now = Date.now();

                        if (lastActivity && (now - parseInt(lastActivity)) < 10 * 60 * 1000) { // 10 minutes
                            if (Math.random() > 0.6) { // 40% chance
                                const messages = Math.random() > 0.5 ? motivationalMessages : fitnessTips;
                                const randomMessage = messages[Math.floor(Math.random() * messages.length)];
                                showMessage(randomMessage, 'info', 4000);
                            }
                        }
                    }, 5 * 60 * 1000); // Every 5 minutes

                    // Track user activity
                    function trackActivity() {
                        localStorage.setItem('last_activity_time', Date.now().toString());
                    }

                    // Enhanced goal tracking with achievements
                    function checkGoalAchievements() {
                        const totalCalories = todayWorkouts.reduce((sum, workout) => sum + workout.caloriesBurned, 0);
                        const mealsCount = todayMeals.length;
                        const workoutsCount = todayWorkouts.length;

                        const today = new Date().toISOString().split('T')[0];

                        // Calorie goal achievement (500 calories)
                        if (totalCalories >= 500 && !localStorage.getItem(`calories_goal_${today}`)) {
                            showMessage("üéâ Amazing! You've burned 500+ calories today!");
                            localStorage.setItem(`calories_goal_${today}`, 'true');

                            // Add achievement badge
                            addAchievementBadge("üî• Calorie Crusher", "Burned 500+ calories in a day");
                        }

                        // Meal consistency achievement (3+ meals)
                        if (mealsCount >= 3 && !localStorage.getItem(`meals_goal_${today}`)) {
                            showMessage("ü•ó Fantastic! You're maintaining great eating habits!");
                            localStorage.setItem(`meals_goal_${today}`, 'true');

                            addAchievementBadge("üçΩÔ∏è Nutrition Champion", "Logged 3+ meals in a day");
                        }

                        // Workout completion achievement
                        if (workoutsCount >= 1 && !localStorage.getItem(`workout_goal_${today}`)) {
                            showMessage("üí™ Excellent! You completed a workout today!");
                            localStorage.setItem(`workout_goal_${today}`, 'true');

                            addAchievementBadge("üèãÔ∏è Fitness Warrior", "Completed a workout");
                        }

                        // Perfect day achievement (all goals met)
                        if (totalCalories >= 500 && mealsCount >= 3 && workoutsCount >= 1 && !localStorage.getItem(`perfect_day_${today}`)) {
                            showMessage("üèÜ PERFECT DAY! You've achieved all your goals!");
                            localStorage.setItem(`perfect_day_${today}`, 'true');

                            addAchievementBadge("üèÜ Perfect Day", "Met all daily goals");
                        }
                    }

                    // Add achievement badge system
                    function addAchievementBadge(title, description) {
                        const badge = document.createElement('div');
                        badge.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0);
        background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
        color: #333;
        padding: 20px;
        border-radius: 20px;
        box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        z-index: 10001;
        text-align: center;
        max-width: 300px;
        animation: achievementPop 3s ease-out forwards;
    `;

                        badge.innerHTML = `
        <div style="font-size: 3rem; margin-bottom: 10px;">üèÜ</div>
        <h5 style="margin: 0; font-weight: bold;">${title}</h5>
        <p style="margin: 5px 0 0 0; font-size: 0.9rem;">${description}</p>
    `;

                        // Add achievement animation
                        const achievementStyle = document.createElement('style');
                        achievementStyle.textContent = `
        @keyframes achievementPop {
            0% {
                transform: translate(-50%, -50%) scale(0) rotate(-180deg);
                opacity: 0;
            }
            20% {
                transform: translate(-50%, -50%) scale(1.1) rotate(10deg);
                opacity: 1;
            }
            40% {
                transform: translate(-50%, -50%) scale(0.95) rotate(-5deg);
            }
            60% {
                transform: translate(-50%, -50%) scale(1.02) rotate(2deg);
            }
            80% {
                transform: translate(-50%, -50%) scale(1) rotate(0deg);
            }
            100% {
                transform: translate(-50%, -50%) scale(0) rotate(0deg);
                opacity: 0;
            }
        }
    `;

                        document.head.appendChild(achievementStyle);
                        document.body.appendChild(badge);

                        setTimeout(() => {
                            badge.remove();
                            achievementStyle.remove();
                        }, 3000);
                    }

                    // Streak counter system
                    function updateStreakCounter() {
                        const today = new Date().toISOString().split('T')[0];
                        const yesterday = new Date();
                        yesterday.setDate(yesterday.getDate() - 1);
                        const yesterdayStr = yesterday.toISOString().split('T')[0];

                        const todayActivity = localStorage.getItem(`activity_${today}`);
                        const yesterdayActivity = localStorage.getItem(`activity_${yesterdayStr}`);

                        let currentStreak = parseInt(localStorage.getItem('current_streak') || '0');

                        if (todayActivity && yesterdayActivity) {
                            currentStreak++;
                            localStorage.setItem('current_streak', currentStreak.toString());

                            // Show streak achievements
                            if (currentStreak === 3) {
                                showMessage("üî• 3-day streak! You're on fire!");
                            } else if (currentStreak === 7) {
                                showMessage("üåü One week streak! Incredible dedication!");
                            } else if (currentStreak === 30) {
                                showMessage("üèÜ 30-day streak! You're a fitness legend!");
                            }
                        }

                        // Mark today as active if user has any activity
                        if (todayMeals.length > 0 || todayWorkouts.length > 0) {
                            localStorage.setItem(`activity_${today}`, 'true');
                        }
                    }

                    // Update your existing functions to include tracking
                    function updateDashboardStats() {
                        const totalCalories = todayWorkouts.reduce((sum, workout) => sum + workout.caloriesBurned, 0);
                        const mealsCount = todayMeals.length;
                        const workoutsCount = todayWorkouts.length;

                        // Calculate progress percentage
                        let progress = 0;
                        if (mealsCount >= 3) progress += 30;
                        else progress += (mealsCount / 3) * 30;

                        if (workoutsCount >= 1) progress += 40;

                        if (totalCalories >= 500) progress += 30;
                        else progress += (totalCalories / 500) * 30;

                        progress = Math.round(progress);

                        // Update DOM elements
                        document.getElementById('caloriesBurned').textContent = totalCalories;
                        document.getElementById('mealsCount').textContent = mealsCount;
                        document.getElementById('workoutsCount').textContent = workoutsCount;
                        document.getElementById('dailyProgress').textContent = `${progress}%`;

                        const progressBar = document.getElementById('progressBar');
                        if (progressBar) {
                            progressBar.style.width = `${progress}%`;
                        }

                        // Update calories progress bar if it exists
                        updateCaloriesProgress(totalCalories);

                        // Track activity and check achievements
                        trackActivity();
                        checkGoalAchievements();
                        updateStreakCounter();
                    }
                    // Complete Toast Notification System - Add this at the end of your JS
                    function showMessage(message, type = 'info', duration = 4000) {
                        // Remove any existing toasts first
                        const existingContainer = document.getElementById('toastContainer');
                        if (!existingContainer) {
                            createToastContainer();
                        }

                        const toastContainer = document.getElementById('toastContainer');
                        const toastId = 'toast-' + Date.now();

                        const iconMap = {
                            'success': '‚úÖ',
                            'error': '‚ùå',
                            'info': '‚ÑπÔ∏è',
                            'warning': '‚ö†Ô∏è'
                        };

                        const colorMap = {
                            'success': 'linear-gradient(135deg, #11998e 0%, #38ef7d 100%)',
                            'error': 'linear-gradient(135deg, #fc466b 0%, #3f5efb 100%)',
                            'info': 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                            'warning': 'linear-gradient(135deg, #fdbb2d 0%, #22c1c3 100%)'
                        };

                        // Create toast element
                        const toast = document.createElement('div');
                        toast.id = toastId;
                        toast.style.cssText = `
        background: ${colorMap[type]};
        color: white;
        padding: 16px 20px;
        border-radius: 12px;
        margin-bottom: 10px;
        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        display: flex;
        align-items: center;
        justify-content: space-between;
        font-weight: 600;
        transform: translateX(100%);
        transition: all 0.3s ease;
        cursor: pointer;
        min-width: 300px;
    `;

                        toast.innerHTML = `
        <span>${iconMap[type]} ${message}</span>
        <button onclick="removeToast('${toastId}')" style="
            background: none; 
            border: none; 
            color: white; 
            font-weight: bold; 
            cursor: pointer;
            font-size: 18px;
            padding: 0;
            margin-left: 10px;
        ">√ó</button>
    `;

                        // Add to container
                        toastContainer.appendChild(toast);

                        // Animate in
                        setTimeout(() => {
                            toast.style.transform = 'translateX(0)';
                        }, 10);

                        // Auto remove
                        setTimeout(() => {
                            removeToast(toastId);
                        }, duration);

                        // Click to dismiss
                        toast.addEventListener('click', () => removeToast(toastId));
                    }

                    function createToastContainer() {
                        const container = document.createElement('div');
                        container.id = 'toastContainer';
                        container.style.cssText = `
        position: fixed;
        top: 100px;
        right: 20px;
        z-index: 9999;
        max-width: 350px;
    `;
                        document.body.appendChild(container);
                    }

                    function removeToast(toastId) {
                        const toast = document.getElementById(toastId);
                        if (toast) {
                            toast.style.transform = 'translateX(100%)';
                            toast.style.opacity = '0';
                            setTimeout(() => {
                                if (toast.parentNode) {
                                    toast.remove();
                                }
                            }, 300);
                        }
                    }

                    // Test the toast system - you can remove this after testing
                    setTimeout(() => {
                        showMessage("üéâ Toast notifications are working!", "success");
                    }, 2000);
                    // Add this to test your API connection
                    async function testAPI() {
                        try {
                            const response = await api.getCurrentUser();
                            console.log('‚úÖ API working:', response);
                            showMessage('API connection successful!', 'success');
                        } catch (error) {
                            console.error('‚ùå API error:', error);
                            showMessage(`API error: ${error.message}`, 'error');
                        }
                    }

                    // Call it to test
                    setTimeout(testAPI, 3000);
                    // Enhanced Dark Mode Toggle with Proper Text Colors
                    function toggleTheme() {
                        const body = document.body;
                        const currentTheme = body.getAttribute('data-theme') || 'light';
                        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

                        // Add transition for smooth theme change
                        body.style.transition = 'all 0.3s ease';

                        // Apply theme
                        body.setAttribute('data-theme', newTheme);
                        localStorage.setItem('fittracker_theme', newTheme);

                        // Update the theme with proper colors
                        if (newTheme === 'dark') {
                            applyDarkTheme();
                            showMessage('üåô Dark mode activated! Easy on the eyes.', 'info', 3000);
                        } else {
                            applyLightTheme();
                            showMessage('‚òÄÔ∏è Light mode activated! Bright and cheerful.', 'info', 3000);
                        }

                        // Update theme icon in dropdown
                        updateThemeIcon(newTheme);

                        // Remove transition after animation
                        setTimeout(() => {
                            body.style.transition = '';
                        }, 300);
                    }

                    // Apply dark theme with proper text colors
                    function applyDarkTheme() {
                        // Apply dark theme CSS class
                        document.body.classList.add('dark-theme');
                        document.body.classList.remove('light-theme');

                        // Update CSS custom properties for dark theme
                        const root = document.documentElement;
                        root.style.setProperty('--bs-body-bg', '#1a1a2e');
                        root.style.setProperty('--bs-body-color', '#ffffff');
                        root.style.setProperty('--bs-card-bg', '#16213e');
                        root.style.setProperty('--bs-border-color', '#0f3460');
                        root.style.setProperty('--bs-text-muted', '#a8b2d1');

                        // Create and inject dark theme styles
                        let darkStylesheet = document.getElementById('dark-theme-styles');
                        if (!darkStylesheet) {
                            darkStylesheet = document.createElement('style');
                            darkStylesheet.id = 'dark-theme-styles';
                            document.head.appendChild(darkStylesheet);
                        }

                        darkStylesheet.textContent = `
        .dark-theme {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%) !important;
            color: #ffffff !important;
        }
        
        .dark-theme .navbar {
            background: linear-gradient(135deg, #0f3460 0%, #533483 100%) !important;
        }
        
        .dark-theme .sidebar {
            background: linear-gradient(180deg, #16213e 0%, #1a1a2e 100%) !important;
            border-color: #0f3460 !important;
        }
        
        .dark-theme .nav-link {
            color: #a8b2d1 !important;
        }
        
        .dark-theme .nav-link:hover {
            color: #ffffff !important;
            background: rgba(255, 255, 255, 0.1) !important;
        }
        
        .dark-theme .nav-link.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            color: #ffffff !important;
        }
        
        .dark-theme .card {
            background: rgba(22, 33, 62, 0.95) !important;
            border-color: #0f3460 !important;
            color: #ffffff !important;
        }
        
        .dark-theme .card-header {
            background: linear-gradient(135deg, #0f3460 0%, #533483 100%) !important;
            border-color: #0f3460 !important;
            color: #ffffff !important;
        }
        
        .dark-theme .stat-card {
            background: rgba(22, 33, 62, 0.95) !important;
            color: #ffffff !important;
        }
        
        .dark-theme .stat-card h2,
        .dark-theme .stat-card h3,
        .dark-theme .stat-card h5,
        .dark-theme .stat-card h6 {
            color: #ffffff !important;
        }
        
        .dark-theme .text-muted {
            color: #a8b2d1 !important;
        }
        
        .dark-theme .fw-bold,
        .dark-theme .fw-semibold {
            color: #ffffff !important;
        }
        
        .dark-theme .activity-item {
            background: rgba(22, 33, 62, 0.8) !important;
            border-color: #0f3460 !important;
            color: #ffffff !important;
        }
        
        .dark-theme .activity-item:hover {
            background: rgba(22, 33, 62, 1) !important;
            border-color: #667eea !important;
        }
        
        .dark-theme .form-control,
        .dark-theme .form-select {
            background-color: #16213e !important;
            border-color: #0f3460 !important;
            color: #ffffff !important;
        }
        
        .dark-theme .form-control:focus,
        .dark-theme .form-select:focus {
            background-color: #16213e !important;
            border-color: #667eea !important;
            color: #ffffff !important;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25) !important;
        }
        
        .dark-theme .form-control::placeholder {
            color: #a8b2d1 !important;
        }
        
        .dark-theme .dropdown-menu {
            background-color: #16213e !important;
            border-color: #0f3460 !important;
        }
        
        .dark-theme .dropdown-item {
            color: #a8b2d1 !important;
        }
        
        .dark-theme .dropdown-item:hover,
        .dark-theme .dropdown-item:focus {
            background-color: rgba(102, 126, 234, 0.2) !important;
            color: #ffffff !important;
        }
        
        .dark-theme .alert {
            background: rgba(22, 33, 62, 0.9) !important;
            border-color: #0f3460 !important;
            color: #ffffff !important;
        }
        
        .dark-theme .alert-info {
            background: rgba(102, 126, 234, 0.2) !important;
            color: #ffffff !important;
        }
        
        .dark-theme .alert-success {
            background: rgba(17, 153, 142, 0.2) !important;
            color: #ffffff !important;
        }
        
        .dark-theme .alert-warning {
            background: rgba(253, 187, 45, 0.2) !important;
            color: #ffffff !important;
        }
        
        .dark-theme .badge {
            color: #ffffff !important;
        }
        
        .dark-theme .border-bottom {
            border-color: #0f3460 !important;
        }
        
        .dark-theme .bg-light {
            background: rgba(22, 33, 62, 0.5) !important;
            color: #ffffff !important;
        }
        
        .dark-theme h1, .dark-theme h2, .dark-theme h3, 
        .dark-theme h4, .dark-theme h5, .dark-theme h6,
        .dark-theme .h1, .dark-theme .h2, .dark-theme .h3,
        .dark-theme .h4, .dark-theme .h5, .dark-theme .h6 {
            color: #ffffff !important;
        }
        
        .dark-theme p, .dark-theme span, .dark-theme div {
            color: inherit !important;
        }
        
        .dark-theme .card-title,
        .dark-theme .card-text {
            color: #ffffff !important;
        }
        
        .dark-theme small {
            color: #a8b2d1 !important;
        }
        
        /* Progress bars remain colorful */
        .dark-theme .progress {
            background-color: rgba(15, 52, 96, 0.3) !important;
        }
        
        /* Stat card specific colors remain vibrant */
        .dark-theme .stat-card.calories-card h2 {
            color: #ff6b6b !important;
        }
        
        .dark-theme .stat-card.meals-card h2 {
            color: #4ecdc4 !important;
        }
        
        .dark-theme .stat-card.workouts-card h2 {
            color: #fa709a !important;
        }
        
        .dark-theme .stat-card.progress-card h2 {
            color: #667eea !important;
        }
    `;
                    }

                    // Apply light theme
                    function applyLightTheme() {
                        // Remove dark theme class and styles
                        document.body.classList.add('light-theme');
                        document.body.classList.remove('dark-theme');

                        // Remove dark theme stylesheet
                        const darkStylesheet = document.getElementById('dark-theme-styles');
                        if (darkStylesheet) {
                            darkStylesheet.remove();
                        }

                        // Reset CSS custom properties for light theme
                        const root = document.documentElement;
                        root.style.setProperty('--bs-body-bg', '#ffffff');
                        root.style.setProperty('--bs-body-color', '#212529');
                        root.style.setProperty('--bs-card-bg', '#ffffff');
                        root.style.setProperty('--bs-border-color', '#dee2e6');
                        root.style.setProperty('--bs-text-muted', '#6c757d');

                        // Reset body styles
                        document.body.style.background = 'linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%)';
                        document.body.style.color = '#212529';
                    }

                    // Update theme icon in dropdown with better text handling
                    // Simple fixed toggleTheme function
                    function toggleTheme() {
                        const body = document.body;
                        const currentTheme = body.getAttribute('data-theme') || 'light';
                        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

                        body.setAttribute('data-theme', newTheme);
                        localStorage.setItem('fittracker_theme', newTheme);

                        if (newTheme === 'dark') {
                            applyDarkTheme();
                            showMessage('üåô Dark mode on', 'info', 2000);
                        } else {
                            applyLightTheme();
                            showMessage('‚òÄÔ∏è Light mode on', 'info', 2000);
                        }

                        // Update icon text
                        const themeLink = document.querySelector('[onclick="toggleTheme()"]');
                        if (themeLink) {
                            if (newTheme === 'dark') {
                                themeLink.innerHTML = '<i class="fas fa-sun me-2"></i>‚òÄÔ∏è Light Mode';
                            } else {
                                themeLink.innerHTML = '<i class="fas fa-moon me-2"></i>üåô Dark Mode';
                            }
                        }
                    }


                    // Load saved theme on page load with proper initialization
                    function loadSavedTheme() {
                        const savedTheme = localStorage.getItem('fittracker_theme');
                        if (savedTheme === 'dark') {
                            document.body.setAttribute('data-theme', 'dark');
                            applyDarkTheme();
                            updateThemeIcon('dark');
                        } else {
                            document.body.setAttribute('data-theme', 'light');
                            applyLightTheme();
                            updateThemeIcon('light');
                        }
                    }

                    // Enhanced initialization
                    document.addEventListener('DOMContentLoaded', function () {
                        console.log('üöÄ Dashboard initialized');

                        // Load theme first
                        loadSavedTheme();

                        // Then initialize other components
                        switchSection('dashboard');

                        // Load today's data
                        setTimeout(loadTodayData, 1000);

                        // Setup form listeners
                        setupFormListeners();
                    });
                    // BMI Calculator Function - ADD THIS TO YOUR JAVASCRIPT SECTION
                    function calculateBMI() {
                        const height = parseFloat(document.getElementById('height').value);
                        const weight = parseFloat(document.getElementById('weight').value);

                        if (!height || !weight || height <= 0 || weight <= 0) {
                            showMessage('Please enter valid height and weight values', 'error');
                            return;
                        }

                        // Calculate BMI
                        const heightInMeters = height / 100;
                        const bmi = (weight / (heightInMeters * heightInMeters)).toFixed(1);

                        // Determine category and color
                        let category, color, advice;
                        if (bmi < 18.5) {
                            category = 'Underweight';
                            color = '#3498db';
                            advice = 'Consider increasing caloric intake with healthy foods ü•ó';
                        } else if (bmi < 25) {
                            category = 'Normal weight';
                            color = '#27ae60';
                            advice = 'Great! Maintain your current lifestyle üí™';
                        } else if (bmi < 30) {
                            category = 'Overweight';
                            color = '#f39c12';
                            advice = 'Consider a balanced diet and regular exercise üèÉ';
                        } else {
                            category = 'Obese';
                            color = '#e74c3c';
                            advice = 'Consult a healthcare professional for guidance üë®‚Äç‚öïÔ∏è';
                        }

                        // Display results
                        document.getElementById('bmiValue').textContent = bmi;
                        document.getElementById('bmiCategory').innerHTML = `
        <strong style="color: ${color}">${category}</strong><br>
        <small>${advice}</small>
    `;
                        document.getElementById('bmiResult').style.display = 'block';

                        showMessage(`üìè BMI calculated: ${bmi} (${category})`, 'success');
                    }
                    // Weather API Integration - ADD THESE FUNCTIONS TO YOUR JAVASCRIPT
                    async function getWeatherSuggestions() {
                        try {
                            document.getElementById('weatherInfo').innerHTML = `
            <div class="text-center">
                <div class="spinner-border text-primary mb-2" role="status"></div>
                <p class="text-muted">Getting your location...</p>
            </div>
        `;

                            // Check if browser supports geolocation
                            if (!navigator.geolocation) {
                                throw new Error('Geolocation not supported by this browser');
                            }

                            // Get user's location
                            navigator.geolocation.getCurrentPosition(async (position) => {
                                const lat = position.coords.latitude;
                                const lon = position.coords.longitude;

                                try {
                                    // Using a free weather API (no key required for basic info)
                                    const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&timezone=auto`);
                                    const data = await response.json();

                                    displayWeatherSuggestions(data);
                                } catch (error) {
                                    console.error('Weather API error:', error);
                                    displayWeatherError('Weather service unavailable');
                                }
                            }, (error) => {
                                console.error('Geolocation error:', error);
                                displayWeatherError('Location access needed for weather suggestions');
                            });

                        } catch (error) {
                            console.error('Weather error:', error);
                            displayWeatherError('Weather feature unavailable');
                        }
                    }

                    function displayWeatherSuggestions(data) {
                        const temp = Math.round(data.current_weather.temperature);
                        const weatherCode = data.current_weather.weathercode;

                        // Simple weather code interpretation
                        let condition, weatherEmoji, suitability, suggestions;

                        if (weatherCode >= 80 && weatherCode <= 99) {
                            // Rain/Storm
                            condition = 'Rainy';
                            weatherEmoji = 'üåßÔ∏è';
                            suitability = 'Indoor Recommended';
                            suggestions = ['Indoor Yoga', 'Home Workout', 'Gym Session', 'Stretching'];
                        } else if (weatherCode >= 70 && weatherCode <= 79) {
                            // Snow
                            condition = 'Snowy';
                            weatherEmoji = '‚ùÑÔ∏è';
                            suitability = 'Indoor Recommended';
                            suggestions = ['Indoor Cardio', 'Strength Training', 'Hot Yoga', 'Treadmill'];
                        } else if (temp > 30) {
                            // Hot weather
                            condition = 'Hot';
                            weatherEmoji = '‚òÄÔ∏è';
                            suitability = 'Early Morning/Evening';
                            suggestions = ['Early Morning Run', 'Swimming', 'Evening Walk', 'Indoor AC Gym'];
                        } else if (temp < 5) {
                            // Cold weather
                            condition = 'Cold';
                            weatherEmoji = 'ü•∂';
                            suitability = 'Warm Up Well';
                            suggestions = ['Brisk Walk', 'Indoor Cardio', 'Winter Jogging', 'Gym Workout'];
                        } else {
                            // Perfect weather
                            condition = 'Pleasant';
                            weatherEmoji = 'üå§Ô∏è';
                            suitability = 'Perfect for Outdoor';
                            suggestions = ['Running', 'Cycling', 'Outdoor Yoga', 'Park Workout', 'Hiking'];
                        }

                        document.getElementById('weatherInfo').innerHTML = `
        <div class="text-center mb-3">
            <div style="font-size: 3rem;">${weatherEmoji}</div>
            <h6 class="fw-bold">${temp}¬∞C - ${condition}</h6>
            <span class="badge bg-primary rounded-pill">${suitability}</span>
        </div>
        
        <h6 class="fw-bold mb-2 text-start">üí° Recommended Workouts:</h6>
        <div class="d-flex flex-wrap gap-2 mb-3">
            ${suggestions.map(suggestion =>
                            `<span class="badge bg-light text-dark rounded-pill">${suggestion}</span>`
                        ).join('')}
        </div>
        
        <div class="text-center">
            <button class="btn btn-sm btn-outline-secondary" onclick="getWeatherSuggestions()">
                <i class="fas fa-sync-alt me-1"></i>Refresh
            </button>
        </div>
    `;

                        showMessage(`üå§Ô∏è Weather updated: ${temp}¬∞C, perfect for ${suggestions[0].toLowerCase()}!`, 'success');
                    }

                    function displayWeatherError(message) {
                        document.getElementById('weatherInfo').innerHTML = `
        <div class="text-center text-muted py-3">
            <i class="fas fa-exclamation-triangle mb-2" style="font-size: 2rem; opacity: 0.5;"></i>
            <p>${message}</p>
            <button class="btn btn-sm btn-outline-primary" onclick="getWeatherSuggestions()">
                <i class="fas fa-redo me-1"></i>Try Again
            </button>
        </div>
    `;
                    }

                    // Auto-load weather when dashboard loads
                    document.addEventListener('DOMContentLoaded', function () {
                        // ... your existing DOMContentLoaded code ...

                        // Auto-load weather after 3 seconds
                        setTimeout(() => {
                            if (document.getElementById('weatherInfo')) {
                                getWeatherSuggestions();
                            }
                        }, 3000);
                    });

                </script>
<script>
// CRITICAL FIX: Proper loading sequence
let dashboardInitialized = false;

document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ Dashboard DOM loaded...');
    initializeDashboard();
});

async function initializeDashboard() {
    if (dashboardInitialized) return;
    
    try {
        // Step 1: Check authentication
        const token = localStorage.getItem('fittracker_token');
        if (!token) {
            window.location.href = 'login.html';
            return;
        }
        
        // Step 2: Wait for API to be ready and set token
        let apiReady = false;
        let attempts = 0;
        
        while (!apiReady && attempts < 20) {
            if (typeof api !== 'undefined') {
                api.setToken(token);
                console.log('‚úÖ API token set successfully');
                apiReady = true;
            } else {
                await new Promise(resolve => setTimeout(resolve, 100));
                attempts++;
            }
        }
        
        if (!apiReady) {
            console.error('‚ùå API not available after waiting');
            return;
        }
        
        // Step 3: Load dashboard data
        console.log('üìä Loading dashboard data...');
        await loadAllDashboardData();
        
        dashboardInitialized = true;
        console.log('‚úÖ Dashboard fully initialized');
        
    } catch (error) {
        console.error('‚ùå Dashboard initialization failed:', error);
    }
}

async function loadAllDashboardData() {
    try {
        // Load today's meals and workouts
        const [mealsResponse, workoutsResponse] = await Promise.all([
            api.getTodayMeals(),
            api.getTodayWorkouts()
        ]);
        
        console.log('‚úÖ Data loaded successfully:', {
            meals: mealsResponse?.meals?.length || 0,
            workouts: workoutsResponse?.workouts?.length || 0
        });
        
        // Update UI elements
        if (typeof displayTodayMeals === 'function') {
            displayTodayMeals(mealsResponse?.meals || []);
        }
        
        if (typeof displayTodayWorkouts === 'function') {
            displayTodayWorkouts(workoutsResponse?.workouts || []);
        }
        
        // Update meal and workout lists in DOM
        updateMealsList(mealsResponse?.meals || []);
        updateWorkoutsList(workoutsResponse?.workouts || []);
        
    } catch (error) {
        console.error('‚ùå Error loading dashboard data:', error);
        showErrorMessage('Failed to load dashboard data. Please refresh the page.');
    }
}

function updateMealsList(meals) {
    const mealsContainer = document.querySelector('#today-meals, .meals-list, [data-meals-container]');
    if (!mealsContainer) return;
    
    if (meals.length === 0) {
        mealsContainer.innerHTML = '<p class="text-muted">No meals logged today. Add your first meal!</p>';
        return;
    }
    
    mealsContainer.innerHTML = meals.map(meal => `
        <div class="meal-item d-flex justify-content-between align-items-center p-3 mb-2 border rounded">
            <div>
                <h6 class="mb-1">${meal.type || 'Meal'}</h6>
                <small class="text-muted">${meal.description || 'No description'}</small>
                <div class="mt-1">
                    <span class="badge bg-primary">${meal.calories || 0} cal</span>
                </div>
            </div>
            <button class="btn btn-danger btn-sm delete-meal-btn" data-meal-id="${meal._id}">
                <i class="fas fa-trash"></i>
            </button>
        </div>
    `).join('');
    
    // Reattach delete listeners
    attachMealDeleteListeners();
}

function updateWorkoutsList(workouts) {
    const workoutsContainer = document.querySelector('#today-workouts, .workouts-list, [data-workouts-container]');
    if (!workoutsContainer) return;
    
    if (workouts.length === 0) {
        workoutsContainer.innerHTML = '<p class="text-muted">No workouts logged today. Start your first workout!</p>';
        return;
    }
    
    workoutsContainer.innerHTML = workouts.map(workout => `
        <div class="workout-item d-flex justify-content-between align-items-center p-3 mb-2 border rounded">
            <div>
                <h6 class="mb-1">${workout.type || 'Workout'}</h6>
                <small class="text-muted">${workout.duration || 0} minutes</small>
                <div class="mt-1">
                    <span class="badge bg-success">${workout.calories || 0} cal burned</span>
                </div>
            </div>
            <button class="btn btn-danger btn-sm delete-workout-btn" data-workout-id="${workout._id}">
                <i class="fas fa-trash"></i>
            </button>
        </div>
    `).join('');
    
    // Reattach delete listeners
    attachWorkoutDeleteListeners();
}

function attachMealDeleteListeners() {
    document.querySelectorAll('.delete-meal-btn').forEach(btn => {
        btn.addEventListener('click', async function() {
            const mealId = this.getAttribute('data-meal-id');
            if (confirm('Delete this meal?')) {
                try {
                    await api.deleteMeal(mealId);
                    await loadAllDashboardData(); // Refresh data
                } catch (error) {
                    console.error('‚ùå Delete meal error:', error);
                }
            }
        });
    });
}

function attachWorkoutDeleteListeners() {
    document.querySelectorAll('.delete-workout-btn').forEach(btn => {
        btn.addEventListener('click', async function() {
            const workoutId = this.getAttribute('data-workout-id');
            if (confirm('Delete this workout?')) {
                try {
                    await api.deleteWorkout(workoutId);
                    await loadAllDashboardData(); // Refresh data
                } catch (error) {
                    console.error('‚ùå Delete workout error:', error);
                }
            }
        });
    });
}

function showErrorMessage(message) {
    console.error('üìä Dashboard Error:', message);
}

// Make loadAllDashboardData available globally for other scripts
window.loadAllDashboardData = loadAllDashboardData;
</script>

                <!-- ... rest of your HTML content ... -->
<!-- At the bottom of dashboard.html, before closing </body> -->
<script src="js/api.js"></script>
<script src="js/progress.js"></script>
<script src="js/dashboard.js"></script>


</body>

</html>

</body>

</html>
